{% extends "puzzles/puzzle_layout.html" %}
{% block title_block %}Net Work{% endblock %}
{% block puzzle_name_block %}Net Work{% endblock %}

{% block puzzle_head_block %}
  <style>
    p.i {
      text-align: center;
      font-style: italic;
    }

    #network {
      width: 100%;
      height: 500px;
      border: 1px solid black;
      border-radius: 8px;
    }

    div.r {
      display: flex;
      justify-content: space-between;
      margin-left: 20px;
      margin-right: 20px;
    }

    ul {
      list-style-type: none;
      padding: 0;
    }
  </style>

  <script type="text/javascript" src="{{ asset_url_for('net_work/vis.min.js') | safe }}"></script>
  <link href="{{ asset_url_for('net_work/vis.min.css') | safe }}" rel="stylesheet" type="text/css" />
{% endblock %}

{% block puzzle_flavortext_block %}
  The Wizard weaves a web of protective spells.
{% endblock %}

{% block puzzle_content_block %}
  <div>
    <p class="i">
      [ Click / Drag / Type ]
    </p>
    <div id="network"></div>
    <script type="text/javascript">
var nodes = new vis.DataSet([
  {id: 1, label: '_ _ _'},
  {id: 2, label: '_ _ _'},
  {id: 3, label: '_ _ _'},
  {id: 4, label: '_ _ _'},
  {id: 5, label: '_ _ _ _'},
  {id: 6, label: '_ _ _ _'},
  {id: 7, label: '_ _ _ _'},
  {id: 8, label: '_ _ _ _'},
  {id: 9, label: '_ _ _ _'},
  {id: 10, label: '_ _ _ _'},
  {id: 11, label: '_ _ _ _'},
  {id: 12, label: '_ _ _ _'},
  {id: 13, label: '_ _ _ _ _'},
  {id: 14, label: '_ _ _ _ _'},
  {id: 15, label: '_ _ _ _ _'},
  {id: 16, label: '_ _ _ _ _'},
  {id: 17, label: '_ _ _ _ _'},
  {id: 18, label: '_ _ _ _ _'},
  {id: 19, label: '_ _ _ _ _'},
  {id: 20, label: '_ _ _ _ _'},
  {id: 21, label: '_ _ _ _ _'},
  {id: 22, label: '_ _ _ _ _ _'},
  {id: 23, label: '_ _ _ _ _ _'},
]);

var edges = new vis.DataSet([
  {from: 1, to: 7},
  {from: 1, to: 14},
  {from: 2, to: 6},
  {from: 3, to: 8},
  {from: 3, to: 16},
  {from: 4, to: 1},
  {from: 4, to: 3},
  {from: 5, to: 16},
  {from: 6, to: 2},
  {from: 7, to: 14},
  {from: 8, to: 2},
  {from: 9, to: 5},
  {from: 9, to: 6},
  {from: 10, to: 14},
  {from: 10, to: 15},
  {from: 10, to: 18},
  {from: 11, to: 2},
  {from: 11, to: 6},
  {from: 12, to: 4},
  {from: 12, to: 9},
  {from: 13, to: 2},
  {from: 13, to: 14},
  {from: 13, to: 5},
  {from: 13, to: 18},
  {from: 14, to: 1},
  {from: 14, to: 7},
  {from: 15, to: 8},
  {from: 16, to: 2},
  {from: 17, to: 11},
  {from: 17, to: 20},
  {from: 17, to: 23},
  {from: 18, to: 6},
  {from: 18, to: 15},
  {from: 20, to: 6},
  {from: 20, to: 16},
  {from: 21, to: 7},
  {from: 21, to: 19},
  {from: 22, to: 11},
  {from: 22, to: 15},
  {from: 22, to: 19},
  {from: 23, to: 5},
  {from: 23, to: 6},
  {from: 23, to: 22}
]);

var container = document.getElementById('network');
var data = {
  nodes: nodes,
  edges: edges
};

var options = {
  interaction: {
    selectable: true,
    selectConnectedEdges: false
  },
  nodes: {
    mass: 2,
    shape: 'box',
    color: {
      background: '#eeeeee',
      border: '#888888',
      highlight:{background:'yellow',border:'black'},
    },
    labelHighlightBold: false,
    font: {
      size: 20,
      color: 'black',
    },
    borderWidth: 2,
  },
  edges: {
    width: 2,
    color: 'black',
    arrows: 'to',
  }
};
var keys = vis.keycharm({
  container: window,
  preventDefault: true
});

function applyKey (key, label) {
  var newLabel = label;
  if (key.length == 1 && key >= 'a' && key <= 'z') {
    var i = label.indexOf('_');
    if (i >= 0) newLabel = label.slice(0,i) + key.toUpperCase() + label.slice(i+1);
  } else if (key == 'backspace') {
    var i = label.indexOf('_');
    if (i != 0) {
      i = (i < 0) ? label.length - 1 : i - 2;
      newLabel = label.slice(0,i) + '_' + label.slice(i+1);
    }
  } else if (key == 'delete') {
    newLabel = label.replace(/[A-Z]/g, '_');
  }
  return newLabel;
}
keys.bindAll(function(event) {
  var key = keys.getKey(event);
  var selection = network.getSelection();
  var nodeID = selection.nodes[0];
  if (!nodeID) return;
  var label = nodes.get(nodeID).label;
  var newLabel = applyKey (key, label);
  nodes.update({id: nodeID, label: newLabel});
},'keydown');

var network = new vis.Network(container, data, options);
    </script>
    <div class="r">
      <div>
        <ul>
          <li>Alpo competitor</li>
          <li>Big kid&rsquo;s loss</li>
          <li>Break, in football</li>
          <li><i>Breaking Bad</i> song</li>
          <li>Brothel</li>
          <li>Chronology</li>
          <li>Common pet</li>
          <li>Cosmetic item</li>
          <li>Dalmatian&rsquo;s home</li>
          <li>Depression sight</li>
          <li>Display</li>
          <li>Drive that&rsquo;s caught</li>
          <li>Editors do this</li>
          <li>Food in the freezer</li>
        </ul>
      </div>
      <div>
        <ul>
          <li>Innovative 1999 film technique</li>
          <li>Item found on a Thanksgiving table</li>
          <li>Its first tenant moved in in 1800</li>
          <li>Japanese innovation</li>
          <li>Like asbestos</li>
          <li>Liquor</li>
          <li>Lone Ranger&rsquo;s calling card</li>
          <li>Many deaf people can do this</li>
          <li>Marking on a ship</li>
          <li>Nineties controversy</li>
          <li>Number 80, alternatively</li>
          <li>Olive Garden offering</li>
          <li>Plutocrat</li>
          <li>Protrude</li>
        </ul>
      </div>
      <div>
        <ul>
          <li>Redden or Beetle, e.g.</li>
          <li>Result of a punch in the mouth</li>
          <li>Rink feature</li>
          <li>Route of the &ldquo;Little Dig&rdquo;</li>
          <li>Sandler film</li>
          <li>Seuss title animal</li>
          <li>Severe snowstorm, sometimes</li>
          <li>Shiny vermin</li>
          <li><i>Sleepless in Seattle</i> locale</li>
          <li>Smoked deli offering</li>
          <li>Summary</li>
          <li>Video player</li>
          <li>Where the eights are kept</li>
          <li>Yeastless baked good</li>
          <li><i>Your answer</i></li>
        </ul>
      </div>
    </div>
  </div>
{% endblock %}
