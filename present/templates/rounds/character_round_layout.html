{% extends "overall_layout.html" %}
{% block styling_block %}
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='character-round.css') }}">
    {% block puzzle_head_block %}{% endblock %}
{% endblock %}

{% block overall_layout_body %}
<div id="round-container">
  <div id="left-sidebar">
    <div id="character-display">
      <img src="{{ asset_url_for('general/stock-%s-full-200px-wide.jpg' % round_id) }}">
      <div id="character-level-container" style="background-image: url({{ asset_url_for('general/icon-small-%s.png' % round_id) }})">{{ team_properties.teamProperties.CharacterLevelsProperty.levels.get(round_id.upper(), 0) if team_properties else 'NA' }}</div>
    </div>
    <div id="navigation">
      <a href="{{ url_for('index') }}"><span class="enscrolled"><span>Back to World Map</span></span></a>
    </div>
  </div>
  <div id="puzzle-container">
    <div id="header">
      <span class="enscrolled"><span>{% block round_name %}{% endblock %}</span></span>
    </div>
    <div id="puzzle-list">
      {% block round_puzzle_entries %}{% endblock %}
    </div>
  </div>
  <br class="clear-both">
</div>
{% endblock %}

{% macro puzzle_entry(puzzle_id, puzzle_properties, puzzle_visibilities) %}
  {% set puzzle_link_action = 'full_puzzle' if full_access else 'puzzle' %}
  {% set link_puzzle_id = puzzle_properties.get(puzzle_id,{}).get('puzzleProperties',{}).get('DisplayIdProperty',{}).get('displayId',puzzle_id) %}
  {% if puzzle_visibilities.get(puzzle_id).status == 'UNLOCKED' %}
    <div class="puzzle-entry">
      <a href="{{ url_for(puzzle_link_action, puzzle_id = link_puzzle_id) }}">
        <span class="puzzle-name">{{ puzzle_properties.get(puzzle_id).puzzleProperties.DisplayNameProperty.displayName }}</span>
      </a>
    </div>
  {% elif puzzle_visibilities.get(puzzle_id).status == 'SOLVED' %}
    <div class="puzzle-entry">
      <a href="{{ url_for(puzzle_link_action, puzzle_id = link_puzzle_id) }}">
        <span class="puzzle-name">{{ puzzle_properties.get(puzzle_id).puzzleProperties.DisplayNameProperty.displayName }}</span>
        <span class="puzzle-solution">{{ puzzle_properties.get(puzzle_id).puzzleProperties.AnswersProperty.answers[0].canonicalAnswer }}</span>
      </a>
    </div>
  {% elif puzzle_visibilities.get(puzzle_id).status == 'VISIBLE' %}
    <div class="puzzle-entry">
      <span class="puzzle-name"><span class="fa fa-key"></span>
        {% set unlock_requirement = single_character_unlock_requirement(puzzle_properties.get(puzzle_id).puzzleProperties) %}
        {% if unlock_requirement.character %}
          <span>{{ unlock_requirement.character.capitalize() }} {{ unlock_requirement.levels }}</span>
        {% endif %}
      </span>
    </div>
  {% endif %}
{% endmacro %}